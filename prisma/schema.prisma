generator client {
  provider   = "prisma-client"
  output     = "./generated"
  engineType = "client"
  runtime    = "bun"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String    @id @default(uuid()) @db.Uuid
  name              String    @db.VarChar(255)
  email             String    @unique @db.VarChar(255)
  password          String    @db.VarChar(255)
  email_verified_at DateTime? @db.Timestamptz(6)
  avatar            String?   @db.VarChar(255)
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  updated_at        DateTime  @updatedAt @db.Timestamptz(6)

  // Relations
  user_roles       UserRole[]
  user_permissions UserPermission[]

  @@index([email], map: "idx_tb_user_email")
  @@index([created_at], map: "idx_tb_user_created_at")
  @@index([email_verified_at], map: "idx_tb_user_email_verified_at")
  @@index([email, email_verified_at], map: "idx_tb_user_email_verified")
  @@map("tb_user")
}

model Role {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique @db.VarChar(100)
  description String?  @db.VarChar(255)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  user_roles       UserRole[]
  role_permissions RolePermission[]

  @@index([name], map: "idx_tb_role_name")
  @@map("tb_role")
}

model Permission {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique @db.VarChar(100)
  description String?  @db.VarChar(255)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  role_permissions RolePermission[]
  user_permissions UserPermission[]

  @@index([name], map: "idx_tb_permission_name")
  @@map("tb_permission")
}

model UserRole {
  id         String   @id @default(uuid()) @db.Uuid
  user_id    String   @db.Uuid
  role_id    String   @db.Uuid
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  role Role @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@unique([user_id, role_id])
  @@index([user_id], map: "idx_tb_user_role_user_id")
  @@index([role_id], map: "idx_tb_user_role_role_id")
  @@map("tb_user_role")
}

model RolePermission {
  id            String   @id @default(uuid()) @db.Uuid
  role_id       String   @db.Uuid
  permission_id String   @db.Uuid
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  role       Role       @relation(fields: [role_id], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permission_id], references: [id], onDelete: Cascade)

  @@unique([role_id, permission_id])
  @@index([role_id], map: "idx_tb_role_permission_role_id")
  @@index([permission_id], map: "idx_tb_role_permission_permission_id")
  @@map("tb_role_permission")
}

model UserPermission {
  id            String   @id @default(uuid()) @db.Uuid
  user_id       String   @db.Uuid
  permission_id String   @db.Uuid
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  user       User       @relation(fields: [user_id], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permission_id], references: [id], onDelete: Cascade)

  @@unique([user_id, permission_id])
  @@index([user_id], map: "idx_tb_user_permission_user_id")
  @@index([permission_id], map: "idx_tb_user_permission_permission_id")
  @@map("tb_user_permission")
}
